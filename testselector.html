<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Month & Year Wheel Selector</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <!-- Tailwind Play CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom wheel effect */

        /* ::-webkit-scrollbar {
            width: 12px;
        }

        ::-webkit-scrollbar-track {
            background: #00000000;
        }

        ::-webkit-scrollbar-thumb {
            background-color: #2e363e;
            border-radius: 6px;
        }

        ::-webkit-scrollbar-corner {
            background: #161a1d;
        } */

        .wheel {
            scrollbar-width: none;
        }

        .wheel::-webkit-scrollbar {
            display: none;
        }

        .option {
            transition: transform .2s, opacity .2s;
        }

        .selector-overlay {
            pointer-events: none;
            position: absolute;
            left: 0;
            right: 0;
            height: 2rem;
            margin: auto;
            top: 0;
            bottom: 0;
            border-radius: .75rem;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            mix-blend-mode: normal;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
    </style>
</head>

<body
    class="min-h-screen bg-gradient-to-b from-gray-900 to-gray-800 text-gray-100 flex items-center justify-center p-4">
    <div class="max-w-md w-full">
        <!-- Display selected -->
        <div class="mb-6 text-center">
            <div class="text-sm uppercase tracking-wide text-gray-400">Selected</div>
            <div id="display" class="mt-1 text-2xl font-semibold flex items-baseline justify-center gap-2">
                <div id="sel-month">August</div>
                <div id="sel-year">2025</div>
            </div>
        </div>

        <!-- Wheels -->
        <div class="relative grid grid-cols-2 gap-4 bg-gray-900/60 rounded-2xl p-6">
            <!-- Month wheel -->
            <div class="flex flex-col items-center">
                <div class="mb-2 text-xs uppercase tracking-wide text-gray-400">Month</div>
                <div aria-label="Month selector" role="listbox" tabindex="0" class="relative w-full">
                    <!-- overlay highlight -->
                    <div class="selector-overlay"></div>
                    <div id="month-wheel"
                        class="wheel relative h-72 overflow-y-scroll scroll-snap-y snap-mandatory flex flex-col items-start py-36">
                        <!-- months injected by JS -->
                    </div>
                </div>
            </div>

            <!-- Year wheel -->
            <div class="flex flex-col items-center">
                <div class="mb-2 text-xs uppercase tracking-wide text-gray-400 flex items-center gap-2">
                    <span>Year</span>
                </div>
                <div aria-label="Year selector" role="listbox" tabindex="0" class="relative w-full">
                    <div class="selector-overlay"></div>
                    <div id="year-wheel"
                        class="wheel relative h-72 overflow-y-scroll scroll-snap-y snap-mandatory flex flex-col items-start py-36">
                        <!-- years injected by JS -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // data
        const months = [
            "January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"
        ];
        const monthWheel = document.getElementById("month-wheel");
        const yearWheel = document.getElementById("year-wheel");
        const displayMonth = document.getElementById("sel-month");
        const displayYear = document.getElementById("sel-year");
        const announcer = document.getElementById("aria-announcer");

        // helper to build option elements
        function createOption(text, type, value) {
            const btn = document.createElement("button");
            btn.type = "button";
            btn.className = "option w-full text-center py-2 text-lg font-medium leading-none scroll-snap-align-center focus:outline-none snap-center";
            btn.setAttribute("role", "option");
            btn.dataset.value = value;
            btn.dataset.type = type;
            btn.innerText = text;
            btn.addEventListener("click", () => {
                // scroll into center
                btn.scrollIntoView({ block: "center", behavior: "smooth" });
            });
            return btn;
        }

        // populate months
        months.forEach((m, i) => {
            const el = createOption(m, "month", i);
            monthWheel.appendChild(el);
        });

        // populate years 0..3000
        for (let y = 1800; y <= 2200; y++) {
            const el = createOption(String(y), "year", y);
            yearWheel.appendChild(el);
        }

        // snap configuration via CSS custom property
        // (Tailwind doesn't yet have scroll-snap-y in CDN default so use attributes)
        monthWheel.style.scrollSnapType = "y mandatory";
        monthWheel.style.scrollSnapAlign = "center";
        yearWheel.style.scrollSnapType = "y mandatory";
        yearWheel.style.scrollSnapAlign = "center";

        // Utility: find the centered child in a wheel
        function getCenteredOption(container) {
            const containerRect = container.getBoundingClientRect();
            const centerY = containerRect.top + containerRect.height / 2;
            let closest = null;
            let closestDistance = Infinity;
            container.querySelectorAll(".option").forEach(opt => {
                const r = opt.getBoundingClientRect();
                const itemCenterY = r.top + r.height / 2;
                const dist = Math.abs(centerY - itemCenterY);
                if (dist < closestDistance) {
                    closestDistance = dist;
                    closest = opt;
                }
            });
            return closest;
        }

        // Apply dynamic scaling/opacity for wheel effect
        function adjustWheelVisuals(container) {
            const containerRect = container.getBoundingClientRect();
            const centerY = containerRect.top + containerRect.height / 2;
            container.querySelectorAll(".option").forEach(opt => {
                const r = opt.getBoundingClientRect();
                const itemCenterY = r.top + r.height / 2;
                const distance = Math.abs(centerY - itemCenterY);
                const maxDistance = containerRect.height / 2; // beyond this, minimal
                let ratio = Math.min(distance / maxDistance, 1); // 0 at center, 1 at far
                // scale from 1 to 0.8
                const scale = 1 - 0.2 * ratio;
                // opacity from 1 to 0.3
                const opacity = 1 - 0.7 * ratio;
                opt.style.transform = `scale(${scale})`;
                opt.style.opacity = opacity;
            });
        }

        // Update selection state, aria-selected, display
        let currentMonthIndex = null;
        let currentYearValue = null;

        function refreshSelection() {
            const centeredMonth = getCenteredOption(monthWheel);
            const centeredYear = getCenteredOption(yearWheel);
            if (centeredMonth) {
                const newIdx = parseInt(centeredMonth.dataset.value, 10);
                if (newIdx !== currentMonthIndex) {
                    currentMonthIndex = newIdx;
                    displayMonth.textContent = months[newIdx];
                }
            }
            if (centeredYear) {
                const newYear = parseInt(centeredYear.dataset.value, 10);
                if (newYear !== currentYearValue) {
                    currentYearValue = newYear;
                    displayYear.textContent = newYear;
                }
            }
        }

        // Throttle with requestAnimationFrame
        let tickScheduled = false;
        function onScroll() {
            if (!tickScheduled) {
                tickScheduled = true;
                requestAnimationFrame(() => {
                    adjustWheelVisuals(monthWheel);
                    adjustWheelVisuals(yearWheel);
                    refreshSelection();
                    tickScheduled = false;
                });
            }
        }

        monthWheel.addEventListener("scroll", onScroll);
        yearWheel.addEventListener("scroll", onScroll);

        // Keyboard navigation (arrow up/down) when wheel is focused
        // function attachKeyboardNav(container, type) {
        //     container.addEventListener("keydown", (e) => {
        //         let centered = getCenteredOption(container);
        //         if (!centered) return;
        //         let target;
        //         if (e.key === "ArrowDown") {
        //             target = centered.nextElementSibling;
        //             e.preventDefault();
        //         } else if (e.key === "ArrowUp") {
        //             target = centered.previousElementSibling;
        //             e.preventDefault();
        //         }
        //         if (target) {
        //             target.scrollIntoView({ block: "center", behavior: "smooth" });
        //         }
        //     });
        // }
        // attachKeyboardNav(monthWheel.parentElement, "month");
        // attachKeyboardNav(yearWheel.parentElement, "year");
        // Note: parentElement has tabindex=0 for accessibility; but wheel itself could be focused

        // Jump to year input
        // document.getElementById("jump-btn").addEventListener("click", () => {
        //     const val = document.getElementById("jump-year").value;
        //     let y = parseInt(val, 10);
        //     if (isNaN(y) || y < 0) y = 0;
        //     if (y > 3000) y = 3000;
        //     const target = yearWheel.querySelector(`.option[data-value="${y}"]`);
        //     if (target) {
        //         target.scrollIntoView({ block: "center", behavior: "smooth" });
        //         target.focus({ preventScroll: true });
        //     }
        // });
        // document.getElementById("jump-year").addEventListener("keypress", (e) => {
        //     if (e.key === "Enter") {
        //         document.getElementById("jump-btn").click();
        //     }
        // });

        // Initialize to current date (fallback if beyond range)
        const now = new Date();
        const initMonth = now.getMonth(); // 0-based
        const initYear = now.getFullYear();
        // scroll them into view after a short delay so layout settled
        window.addEventListener("load", () => {
            const mEl = monthWheel.querySelector(`.option[data-value="${initMonth}"]`);
            const yVal = Math.min(3000, Math.max(0, initYear));
            const yEl = yearWheel.querySelector(`.option[data-value="${yVal}"]`);
            if (mEl) mEl.scrollIntoView({ block: "center" });
            if (yEl) yEl.scrollIntoView({ block: "center" });
            // initial visual adjustment
            adjustWheelVisuals(monthWheel);
            adjustWheelVisuals(yearWheel);
            refreshSelection();
        });

        // Click outside to allow focus on wheel for keyboard nav
        [monthWheel, yearWheel].forEach(w => {
            w.setAttribute("tabindex", "0");
            w.addEventListener("focus", () => {
                // do nothing but allow arrow keys to work
            });
        });

        // Ensure the "selector-overlay" centers properly: nothing additional needed since it's absolute inside container with padding.

        const speedFactor = 0.5; // 1 = normal speed; lower = slower

        monthWheel.addEventListener('wheel', function (e) {
            // needed so we can call preventDefault()
            e.preventDefault();

            // Normalize delta to pixels
            let delta = e.deltaY;
            if (e.deltaMode === 1) { // DOM_DELTA_LINE
                const lineHeight = parseFloat(getComputedStyle(monthWheel).lineHeight) || 16;
                delta *= lineHeight;
            } else if (e.deltaMode === 2) { // DOM_DELTA_PAGE
                delta *= monthWheel.clientHeight;
            }

            // Apply slowed scroll
            monthWheel.scrollTo({
                top: monthWheel.scrollTop + (delta * speedFactor),
                left: 0,
                behavior: "smooth",
            });

        }, { passive: false });

        yearWheel.addEventListener('wheel', function (e) {
            // needed so we can call preventDefault()
            e.preventDefault();

            // Normalize delta to pixels
            let delta = e.deltaY;
            if (e.deltaMode === 1) { // DOM_DELTA_LINE
                const lineHeight = parseFloat(getComputedStyle(yearWheel).lineHeight) || 16;
                delta *= lineHeight;
            } else if (e.deltaMode === 2) { // DOM_DELTA_PAGE
                delta *= yearWheel.clientHeight;
            }

            // Apply slowed scroll
            yearWheel.scrollTo({
                top: yearWheel.scrollTop + (delta * speedFactor),
                left: 0,
                behavior: "smooth",
            });
        }, { passive: false });
    </script>
</body>

</html>