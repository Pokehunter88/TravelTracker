<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link rel="stylesheet" as="style" onload="this.rel='stylesheet'"
        href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Space+Grotesk%3Awght%40400%3B500%3B700" />

    <title>Travel Tracker</title>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        body {
            touch-action: manipulation;
            overflow: hidden;
            height: 100dvh;
        }
    </style>
</head>

<body>
    <div class="relative flex size-full min-h-[100dvh] flex-col bg-[#161a1d] dark group/design-root overflow-x-hidden"
        style='--checkbox-tick-svg: url(&apos;data:image/svg+xml,%3csvg viewBox=%270 0 16 16%27 fill=%27rgb(22,26,29)%27 xmlns=%27http://www.w3.org/2000/svg%27%3e%3cpath d=%27M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z%27/%3e%3c/svg%3e&apos;); font-family: "Space Grotesk", "Noto Sans", sans-serif;'>
        <div class="layout-container flex h-full grow flex-col">
            <header
                class="flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#2e363e] px-5 py-3">
                <div class="flex items-center gap-4 text-white">
                    <div class="size-4">
                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
                            class="bi bi-globe" style="transform: translate(-5px, -5px);" viewBox="0 0 16 16">
                            <path
                                d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m7.5-6.923c-.67.204-1.335.82-1.887 1.855A8 8 0 0 0 5.145 4H7.5zM4.09 4a9.3 9.3 0 0 1 .64-1.539 7 7 0 0 1 .597-.933A7.03 7.03 0 0 0 2.255 4zm-.582 3.5c.03-.877.138-1.718.312-2.5H1.674a7 7 0 0 0-.656 2.5zM4.847 5a12.5 12.5 0 0 0-.338 2.5H7.5V5zM8.5 5v2.5h2.99a12.5 12.5 0 0 0-.337-2.5zM4.51 8.5a12.5 12.5 0 0 0 .337 2.5H7.5V8.5zm3.99 0V11h2.653c.187-.765.306-1.608.338-2.5zM5.145 12q.208.58.468 1.068c.552 1.035 1.218 1.65 1.887 1.855V12zm.182 2.472a7 7 0 0 1-.597-.933A9.3 9.3 0 0 1 4.09 12H2.255a7 7 0 0 0 3.072 2.472M3.82 11a13.7 13.7 0 0 1-.312-2.5h-2.49c.062.89.291 1.733.656 2.5zm6.853 3.472A7 7 0 0 0 13.745 12H11.91a9.3 9.3 0 0 1-.64 1.539 7 7 0 0 1-.597.933M8.5 12v2.923c.67-.204 1.335-.82 1.887-1.855q.26-.487.468-1.068zm3.68-1h2.146c.365-.767.594-1.61.656-2.5h-2.49a13.7 13.7 0 0 1-.312 2.5m2.802-3.5a7 7 0 0 0-.656-2.5H12.18c.174.782.282 1.623.312 2.5zM11.27 2.461c.247.464.462.98.64 1.539h1.835a7 7 0 0 0-3.072-2.472c.218.284.418.598.597.933M10.855 4a8 8 0 0 0-.468-1.068C9.835 1.897 9.17 1.282 8.5 1.077V4z" />
                        </svg>
                    </div>
                    <a class="text-white text-lg font-bold leading-tight tracking-[-0.015em]" href="/index.html">Travel
                        Tracker</a>
                </div>
                <div class="flex flex-1 justify-end gap-5">
                    <div
                        class="grid grid-cols-2 grid-rows-2 px-2 md:grid-cols-4 md:grid-rows-1 items-center gap-x-5 gap-y-1">
                        <a class="text-white text-sm font-medium leading-normal" href="/list.html">Countries</a>
                        <a class="text-white text-sm font-medium leading-normal" href="/timeline.html">Timeline</a>
                        <a class="text-white text-sm font-medium leading-normal" href="/wishlist.html">Wishlist</a>
                        <a class="text-white text-sm font-medium leading-normal" href="/map.html">Map</a>
                    </div>
                    <!-- <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10"
                        style='background-image: url("https://static.vecteezy.com/system/resources/previews/005/544/718/non_2x/profile-icon-design-free-vector.jpg");'>
                    </div> -->
                </div>
            </header>
            <div class="flex flex-1 justify-center py-5">
                <div class="layout-content-container flex flex-col flex-1">
                    <div
                        class="tracking-[-0.015em] px-4 pb-2 pt-4 place-self-center border-b border-t border-t-[#2e363e] border-solid border-b-[#2e363e] flex">
                        <div class="px-4">
                            <p class="text-white text-2xl font-bold leading-tight place-self-center" id="world-count">0%
                            </p>
                            <p class="text-gray-500 text-0.5xl font-bold leading-tight place-self-center">World</p>
                        </div>
                        <div class="px-4">
                            <p class="text-white text-2xl font-bold leading-tight place-self-center" id="visited-count">
                                0</p>
                            <p class="text-gray-500 text-0.5xl font-bold leading-tight place-self-center">Countries
                                Visited</p>
                        </div>
                    </div>
                    <div id="map" class="h-full bg-[#161a1d]"></div>

                    <script>
                        function getSaveData() {
                            try {
                                const saveData = JSON.parse(localStorage.getItem("saveData") ?? { countryVisits: [], countryWishlists: [] });

                                if (saveData.countryVisits === undefined) {
                                    saveData.countryVisits = [];
                                }
                                if (saveData.countryWishlists === undefined) {
                                    saveData.countryWishlists = [];
                                }

                                return saveData;
                            } catch (e) {
                                return { countryVisits: [], countryWishlists: [] };
                            }
                        }

                        // Example visited countries using ISO Alpha-2 codes
                        const visitedCountries = []; // ‚Üê change as needed

                        const saveData = getSaveData();

                        for (let i = 0; i < saveData.countryVisits.length; i++) {
                            if (!visitedCountries.includes(saveData.countryVisits[i].country.toUpperCase())) {
                                visitedCountries.push(saveData.countryVisits[i].country.toUpperCase());
                            }
                        }

                        document.getElementById('visited-count').innerText = visitedCountries.length + "/250";
                        document.getElementById('world-count').innerText = Math.ceil((visitedCountries.length / 250) * 100) + "%";

                        // Style function: color visited countries green, others gray
                        function countryStyle(feature) {
                            const isoCode = feature.properties["ISO_A2_EH"];
                            return {
                                fillColor: visitedCountries.includes(isoCode) ? '#FFFFFF' : '#2e363e',
                                weight: 3,
                                color: visitedCountries.includes(isoCode) ? '#FFFFFF' : '#2e363e',
                                fillOpacity: 1
                            };
                        }

                        function onEachCountry(feature, layer) {
                            layer.on({
                                mouseover: (e) => {
                                    const layer = e.target;
                                    layer.setStyle({
                                        fillColor: '#FFFFFF',
                                        color: '#FFFFFF',
                                    });
                                    // You now know which country is hovered:
                                    console.log('Hovering over:', feature.properties.ADMIN);
                                },
                                mouseout: (e) => {
                                    const isoCode = feature.properties["ISO3166-1-Alpha-2"];
                                    const layer = e.target;
                                    layer.setStyle({
                                        fillColor: visitedCountries.includes(isoCode) ? '#FFFFFF' : '#2e363e',
                                        color: visitedCountries.includes(isoCode) ? '#FFFFFF' : '#2e363e',
                                    });
                                },
                                click: (e) => {
                                    // optional: click to toggle visited
                                }
                            });
                        }

                        // Create Leaflet map
                        const map = L.map('map', {
                            zoomControl: false,
                            // dragging: false,
                            // touchZoom: false,
                            doubleClickZoom: false,
                            // scrollWheelZoom: false,
                            boxZoom: false,
                            keyboard: false,
                            tap: false,
                            attributionControl: false
                        }).setView([0, 0], 1);

                        // Load country GeoJSON data
                        fetch('/ne_50m_admin_0_countries.geojson', { cache: "force-cache" })
                            .then(res => res.json())
                            .then(data => {
                                L.geoJSON(data, {
                                    style: countryStyle,
                                    // onEachFeature: onEachCountry
                                }).addTo(map);
                            });
                    </script>
                </div>
            </div>
        </div>
    </div>
</body>

</html>